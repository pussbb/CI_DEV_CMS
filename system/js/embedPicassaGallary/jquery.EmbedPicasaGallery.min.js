(function(b){var a="EmbedPicasaGallery",c;b[a]={defaultOptions:{matcher:RegExp(".+"),size:72,msg_loading_list:"Loading album list from PicasaWeb",msg_back:"Back",album_title_tag:"<h2/>",thumb_id_prefix:"pThumb_",thumb_tuner:null,thumb_finalizer:null,loading_animation:null,link_mapper:function(d){return[d.href,'<a href="'+d.href+'">'+d.title+"</a>"]}}};b.fn[a]=function(e,g){var f,h={};f=b.extend({},b[a].defaultOptions,g);function d(){var n,k,l,o,m="";if(h.__overview){h.__overview.show();return}n=b(this);n.empty();n.append(b("<br/>").css("clear","left"));k=f;if(b.meta){k=b.extend({},f,n.data())}l=0;o=b("<div/>").addClass("album-list").append(b("<div/>").text(k.msg_loading_list));function p(s,t){var u,q,r;u=t.media$group.media$title.$t;if(u.match(k.matcher)){l++;r=b("<img/>").attr("title",u).attr("src",t.media$group.media$thumbnail[0].url);q=b("<div/>").addClass("album-cover").css({"float":"left",marginRight:"10px",marginBottom:"10px"}).click(function(){o.hide();i(n,k,t.gphoto$id.$t,u,t.gphoto$numphotos.$t)}).hover(function(){b(this).css("cursor","pointer")},function(){b(this).css("cursor","default")}).append(r).append(b("<div/>").addClass("album-title").css({"font-size":"10px"}).text(u).width(k.size));o.append(q)}}function j(s){var r,q=0;o.empty();if(s.feed&&s.feed.entry){b.each(s.feed.entry,p)}else{n.text("Warning: No picasa albums found for user "+e)}h.__overview=o;r=o.children();if(l==1){r.eq(0).click();return}b(".album-title",o).each(function(){var t=b(this).outerHeight();if(t>q){q=t}}).each(function(){b(this).height(q)})}if(k.authkey){m="&authkey="+k.authkey}if(k.albumid){i(n,k,k.albumid,"")}else{n.prepend(o);b.getJSON("http://picasaweb.google.com/data/feed/api/user/"+e+"?kind=album&access=visible"+m+"&alt=json-in-script&thumbsize="+k.size+"c&callback=?",j)}}function i(s,r,l,t,n){if(h[l]){h[l].show();return}var p,k,u=[],m;k=b("<div/>").addClass("album");if(t){k.append(b(r.album_title_tag).text(t))}function o(){var v=b("<div/>").width(r.size).height(r.size).css({"float":"left",marginRight:"10px",marginBottom:"10px"});if(r.loading_animation){v.css("background","url("+r.loading_animation+") no-repeat center center")}return v}if(h.__overview){k.append(b("<div/>").addClass("pic-thumb").width(r.size).height(r.size).css({"border-width":"0px","float":"left",marginRight:"10px",marginBottom:"10px"}).append(b("<div/>").html("<br/>"+r.msg_back).click(function(){k.hide();d()}).css({"border-style":"outset","border-width":"1px","text-align":"center",width:(r.size-2)+"px",height:(r.size-2)+"px"})))}if(n){for(p=0;p<n;p++){m=o();k.append(m);u.push(m)}}function q(x,y){var A,w,v,z;A=y.media$group.media$description.$t||y.media$group.media$title.$t;w=b(new Image());w.load(function(){if(r.thumb_tuner){r.thumb_tuner(v,y)}w.show()}).css("border-width","0px").hide();z=b("<a/>").attr("href",y.content.src).attr("title",A).append(w);if((v=u[x])==undefined){v=o();k.append(v)}v.attr("id",r.thumb_id_prefix+y.gphoto$id.$t).append(z);w.attr("src",y.media$group.media$thumbnail[0].url)}function j(v){b.each(v.feed.entry,q);if(b.fn.slimbox){b("a",k).slimbox({},r.link_mapper)}if(r.thumb_callback){b("a",k).each(r.thumb_callback)}h[l]=k}c="";if(r.authkey){c="&authkey="+r.authkey}b.getJSON("http://picasaweb.google.com/data/feed/api/user/"+e+"/albumid/"+l+"?kind=photo&access=visible"+c+"&alt=json-in-script&thumbsize="+r.size+"c&imgmax=800&callback=?",j);s.prepend(k)}return this.each(d)}})(jQuery);